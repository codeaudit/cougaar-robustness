<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Adaptive Robustness Use Case 1 (AR-UC1) Setup</title>
                           
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
</head>
  <body>
       
<h1>Adaptive Robustness Use Case 1 Setup</h1>
<br>
           This document provides instructions for configuring a Cougaar
society to  demonstrate/test Adaptive Robustness (AR) Use Case 1 (AR-UC1)
components.   &nbsp;Use Case 1 involves the detection and restart of agents
that have been  lost due to a computer or node failure. &nbsp;These instructions
are based  on the use of a modified version of the SMALL-1AD-TRANS society
that is distributed  with CSMART. &nbsp;With minor variation most of these
instructions  are also  applicable to the setup of the the TINY and FULL
versions of the  standard  1AD sociieties.<br>
<br>
<h2>Obtain Required software</h2>
       
<h3>a. &nbsp;Cougaar</h3>
    Cougaar version 9.4.1.2 or greater is required.<br>
       
<h3>b. &nbsp;Adaptive Robustness JAR files</h3>
    Obtain the JAR files for the following modules from the Ultralog CVS
repository   and copy to the COUGAAR_INSTALL_PATH/lib directory.<br>
    <br>
<ol>
  <li>    Robustness/OBJS/Sensors</li>
  <li>    Robustness/MIC/Mgmt_Agent </li>
</ol>
       
<h3>c. &nbsp;AR Use Case 1 CSMART Recipes</h3>
    A number of CSMART recipes are used to configure the standard 1AD societies
  for AR-UC1 demonstration and testing. &nbsp;The recipes listed below can
 be obtained from the test/data/recipes directory in the Robustness/MIC/Mgmt_Agent
  module or overlay. &nbsp;These recipes should be imported into the CSMART
  database.<br>
    <br>
<ol>
  <li>    HeartbeatServerPlugin-export.sql</li>
  <li>    PingServerPlugin-export.sql</li>
  <li>    SensorDomain-export.sql</li>
  <li>    RobustnessManagementAgents-export.sql</li>
</ol>
    <br>
    In addition to the recipes listed above, the file "recipeQueries.q" in
 the  test/data directory must be copied to the COUGAAR_INSTALL_PART/configs/common
  directory. &nbsp;This file contains a couple unique database queries that
  are used by the AR recipes.<br>
       
<h3>d. &nbsp;AR Use Case 1 CSMART Experiment</h3>
    The following CSMART experiment is provided in the test/data/experiments
  directory in the Robustness/MIC/Mgmt_Agent module. &nbsp;This experiment
 modifies the standard SMALL-1AD-TRANS experiment to define communities and
 agent allocations suitable for running AR-UC1 tests. &nbsp;This experiment
 should be imported into the CSMART database.<br>
    <br>
    - &nbsp;SMALL-1AD-TRANS-AR-export<br>
    <br>
    This experiment contains 58 agents in 4 robustness communities. &nbsp;The
  allocation of agents to communities is as follows:<br>
    <br>
       
<table cellpadding="2" cellspacing="2" border="1" width="300"
 align="center">
      <tbody>
        <tr>
          <td valign="top">1AD-Enclave1-COMM<br>
          </td>
          <td valign="top">32 Agents<br>
          </td>
        </tr>
        <tr>
          <td valign="top">1AD-Enclave2-COMM<br>
          </td>
          <td valign="top">15 Agents<br>
          </td>
        </tr>
        <tr>
          <td valign="top">1AD-Enclave3-COMM<br>
          </td>
          <td valign="top">1 Agent<br>
          </td>
        </tr>
        <tr>
          <td valign="top">1AD-Enclave4-COMM<br>
          </td>
          <td valign="top">10 Agents<br>
          </td>
        </tr>
               
  </tbody>    
</table>
    <br>
    Each community (enclave} has a management agent that is responsible for 
 monitoring the community members and restarting them as necessary. &nbsp;The 
 management agent is given a name like "1AD-Enclave1-RobustnessManager". &nbsp;The
 name must be unique and must end with the string "RobustnessManager".<br>
<br>
       
<h2>2. &nbsp;Modify Experiment Configuration</h2>
    Using the CSMART Experiment Builder tool update the SMALL-1AD-TRANS-AR-export
  experiment to reflect the local environment.<br>
<br>
       
<h3>a. &nbsp;Allocate nodes to hosts<br>
    </h3>
   The SMALL-1AD-TRANS-AR-export experiment is currently configured to run 
23 nodes on 5 computers. &nbsp;Depending on the availability of local resources
  this step may simply involve the re-allocation of the existing nodes to
5  computers in the local enviroment. &nbsp;While it is not normally recommended
  that more than 1 node be allocated to a host, this 5 computer configuration
  defines a number of relatively small nodes for each host. &nbsp;This is
done  to mimic the agent-node allocation in the TICs FULL-1AD society and
also to provide multiple nodes to kill for various UC1 test scenarios. &nbsp;If
 the computers to be used for the society are not capable of running this
number of JVMs the agents in the FWD-X and REAR-X nodes could be consolidated
into single ENCLAVE1 and ENCLAVE2 nodes. Similarily the agents in the AIR-NODE,
  CONUS-NODE, CONTRANS-NODE, SEA-NODE, THEATERTRANS-NODE, and TRANSCOM-NODE
  nodes could be combined to form a singe ENCLAVE4 node. <br>
    <br>
       
<h3>b. &nbsp;Specify restart nodes</h3>
   Each robustness community in the SMALL-1AD-TRANS-AR-export experiment
designates   a specific node for restarting dead agents. &nbsp;By default
this node is   named something like "Enclave1-RestartNode". &nbsp;The designation
of restart   nodes for a community is performed using a community level attribute.
&nbsp;This   attribute is found by going to the "Community" tab in the CSMART
Experiment   Builder tool. &nbsp;Select the appropriate community from the
community list.  &nbsp;The community name will be something like "1AD-Enclave1-COMM".<br>
       
<ol>
    <li><i>Changing the restart node</i> &nbsp;- &nbsp;To change the name 
of the restart  node simply modify the ATTRIBUTE_VALUE associated with the 
existing RestartNode  id.<br>
    </li>
     <li><i>Deleting the restart node</i> &nbsp;- &nbsp;To delete the restart 
 node right click on the existing attribute entry and select "delete" from 
 the pop-up menu. &nbsp;If a robustness community does not specify a &nbsp;restart
  node the Management Agent will consider any node currently used by a commuity
  member as a possible destination for a restarted agent.<br>
    </li>
     <li><i>Adding restart nodes</i> &nbsp;- &nbsp;The default experiment 
specifies  1 restart node for each restart community. &nbsp;However, multiple 
restrart  nodes may be designated. &nbsp;To add additional nodes right click 
on the  community name from the community list pane and select "Add Attribute" 
from  the pop-up menu. &nbsp;Then add "RestartNode" to the new ATTRIBUTE_ID 
and  the name of the node to the ATTRIBUTE_VALUE field. &nbsp;When multiple 
restart  nodes are specified the Management Agent will consider all of these 
as possible  destinations for a restarted agent. &nbsp;The actual node selected 
will be  the one with the fewest number of running agents</li>
     
</ol>
       
<h2>3. &nbsp;Run Society</h2>
    Once the required software has been installed and configured the experiment
  can be executed using the CSMART Experiment Controller tool. &nbsp;Using
 the Experiment Controller run the experiment configured from step 2 above.
 &nbsp;Monitor the log messages from 4 management agent nodes (named 1AD-EnclaveX-RobustnessManager).
  &nbsp;As the society is starting each management agent will detect the
existence   of the community members that it is monitoring and will log an
INFO message   "Adding XXXX" where XXXX is the name of the agent to be monitored.
&nbsp;Periodically   each management agent will log a summary message indicating
the total number   of agents being monitored and the current state of each.
&nbsp;All agents   should transition to the NORMAL state within a few minutes
of startup. &nbsp;The   NORMAL state indicates that the management agent
was successful in starting   the monitored agents HeartbeatServer. &nbsp;At
this point individual nodes   can be killed via the Control-&gt;Kill menu
item in a nodes console window.   &nbsp;When a node is killed the management
agent will log various warning   and error messages indicating heartbeat
and ping failures. &nbsp;Eventually   the dead agents will be retarted on
a restart node. &nbsp;If the restart  is successful, a log message "Reacquired
XXXX" will be generated where XXXX  is the name of the agent that was restarted.<br>
<br>
<h2>4. &nbsp;Modifying Robustness Parameters</h2>
The AR-UC1 components support the capability to override default values and
to define agent-specific values for the following parameters. &nbsp;The SMALL-1AD-AR-export
experiment discussed above uses the default values listed in the table below.
&nbsp;While these are reasonable values they have not been optimized for
any particular configuration. &nbsp;<br>
<br>
<table cellpadding="2" cellspacing="2" border="2" width="90%"
 align="center">
  <caption><br>
  </caption><tbody>
    <tr>
      <th valign="middle" align="center" width="20%"><b>Parameter Name<br>
      </b></th>
      <td valign="top" align="center"><b>Plugin</b><br>
      </td>
      <td valign="middle" align="center" width="15%"><b>Default Value</b><br>
      </td>
      <th valign="top" align="center"><b>Description</b><br>
      </th>
    </tr>
    <tr>
      <td valign="top">hbReqTimeout<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">60000<br>
      </td>
      <td valign="top">Defines the timeout period (in milliseconds) for a
heartbeat request.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbReqRetries<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">1<br>
      </td>
      <td valign="top">Defines the number of times to retry a heartbeat request
when a failure is encountered. &nbsp;If the value is set to -1 retries will
continue indefinately.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbReqRetryFreq<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">60000<br>
      </td>
      <td valign="top">Defines the interval (in milliseconds) between heartbeat
request retries.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbFreq<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">30000<br>
      </td>
      <td valign="top">Defines the frequency (in milliseconds) at which the
monitored agents are to send heartbeats to the management agent.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbTimeout<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">30000<br>
      </td>
      <td valign="top">Defines the timeout (in milliseconds) period for hearbeats.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbPctLate<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">80.0<br>
      </td>
      <td valign="top">Defines a tolerance for late heartbeats before they
are reported in a Heartbeat Health Report that is processed by the HealthMonitorPlugin.
&nbsp;The value is defined as a float point number representing a percentage
of the hbTimeout.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbWindow<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">360000<br>
      </td>
      <td valign="top">Defines the interval (in milliseconds) over which
a heartbeat failure rate is calculated. &nbsp;<br>
      </td>
    </tr>
    <tr>
      <td valign="top">hbFailRate<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">50.0<br>
      </td>
      <td valign="top">Defines the heartbeat failure rate threshold. &nbsp;When
the calculated heartbeat failure rate exceeds this threshold the monitored
agent is placed into the "HEALTH_CHECK" state for further evaluation by the
Management Agent. &nbsp;This value is the percentage of late heartbeats vs
expected heartbeats.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">activePingFreq<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">0<br>
      </td>
      <td valign="top">Defines the frequency (in milliseconds) at which agents
are pinged. &nbsp;Active pings are performed in addition to the heartbeat
monitored. &nbsp;If active pings are not required this value should be set
to 0.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">pingTimeout<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">60000<br>
      </td>
      <td valign="top">Defines the ping timeout period (in milliseconds).<br>
      </td>
    </tr>
    <tr>
      <td valign="top">pingRetries<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">1<br>
      </td>
      <td valign="top">Defines the number of time to retry a failed ping.<br>
      </td>
    </tr>
    <tr>
      <td valign="top">evalFreq<br>
      </td>
      <td valign="top">HealthMonitorPlugin<br>
      </td>
      <td valign="top" align="right">10000<br>
      </td>
      <td valign="top">Defines the delay (in milliseconds) between execution
of the healh status evaluation loop used by the HealthMonitorPlugin. <br>
      </td>
    </tr>
    <tr>
      <td valign="top">restartNode<br>
      </td>
      <td valign="top">RestartLocatorPlugin<br>
      </td>
      <td valign="top"><br>
      </td>
      <td valign="top">Defines the name(s) of node(s) to use for restarting
dead agents.&nbsp; If no restart nodes are specified the Management Agent
will consider any node used by a robustness community member as a candidate
destination.<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h4>a. &nbsp;Overriding default values</h4>
New default parameter values are specified as plugin arguments. &nbsp;For
instance to change the heartbeat frequency for all agents to 2 minutes, the
argument "hbFreq=120000" would be specified. &nbsp;When using .ini files
multiple arguments must be separated by commas. &nbsp;For instance:<br>
<pre>plugin=org.cougaar.tools.robustness.ma.HealthMonitorPlugin(hbFreq=120000,&nbsp;pingRetries=2)</pre>
The restartNode parameter allows more than one restart node to be defined.
&nbsp;If multiple nodes are defined the node names must be separated by spaces.
&nbsp;In addition to specifying restart nodes as a plugin argument to the
RestartLocatorPlugin, this parameter may also be defined using community-level
attributes. &nbsp;Using the CSMART community editor add a RestartNode attribute
for each node to be used as a restart destination. &nbsp;<br>
<br>
<h4>b. &nbsp;Specifying agent-specific values</h4>
Agent-specific values are specified using entity-level attributes in the
appropriate robustness community definition. &nbsp;Using the CSMART community
editor locate the community and agent requiring a non-default parameter value.
&nbsp;Add an attribute id (from the table above) and value for the parameter
to be defined. &nbsp;For instance if an agent requires a longer ping timeout
(e.g., 2 minutes) period the attribute value "pingTimeout" would be created
with the value "120000". &nbsp;This value would override the community-wide
default that was defined.<br>
       
</body>
</html>
